<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Posts</title>
  <link rel="stylesheet" href="/static/post.css" />
</head>

<body>
  <!-- Top bar -->
  <div class="bar">
    {{if .Username}}
      <a href="/logout" class="bar-link">Logout</a>
      <p>WELCOME {{.Username}}</p>
    {{else}}
      <a href="/login" class="bar-link">Login</a>
      <a href="/register" class="bar-link">Register</a>
    {{end}}
  </div>

  <br>

  <!-- Create Post Button -->
  <a class="Create" href="{{if .Username}}#show{{else}}/login{{end}}">
    <button>CREATE YOUR POST</button>
  </a>

  <!-- Modal Create Post -->
  <div id="show" class="modal {{if .Popup}}showit{{end}}">
    <a href="{{.Path}}">
      <button class="back"></button>
    </a>

    <div class="addpost">
      <a href="{{.Path}}" class="close">&times;</a>

      <form method="POST" action="/post" class="table-post">
        <label>Add title</label>
        <input class="title" type="text" name="title" placeholder="Enter your post title" value="{{.Cachetitle}}"> 
        <br>

        <label>Content</label>
        <textarea class="content" name="content" placeholder="Write something...">{{if .Cacheconetent}}{{.Cacheconetent}}{{end}}</textarea>

        <fieldset>
          <legend>Choose categories:</legend>
          {{range .Categories}}
            <label>
              <input type="checkbox" name="category_ids" value="{{.}}"> {{.}}
            </label><br>
          {{end}}
        </fieldset>

        {{if .Error}}
          <p class="error">{{.Error}}</p>
        {{end}}

        <br>
        <button class="sub_post" type="submit">Create Post</button>
      </form>
    </div>
  </div>

 
  <!-- Main Content -->
  <main class="container">
    <!-- Sidebar -->
    <aside class="sidebar">
      <h3>Categories</h3>
      <ul class="category-list">
        <li><a href="/post" >All Posts</a></li>
        {{if .Username}}
          <li><a href="/post?Categories={{.Username}}">My Posts</a></li>
         

        {{end}}
        {{range .Categories}}
        
        {{if eq . "Liked"}}
          <li><a href="/post?Categories={{.}}">Liked Posts</a></li>
        {{else}}
          <li><a href="/post?Categories={{.}}">{{.}}</a></li>
          {{end}}
        {{end}}
      </ul>
    </aside>

    <!-- Posts Section -->
    <section class="posts">
      {{range .Posts}}
      <article id="{{.IdPost}}"  class="post-card" style="scroll-margin-top: 100px;">
        <div  class="post-header">
          <h2>{{.Title}}</h2>
        </div>
        <p class="post-content">{{.Content}}</p>
      {{if .Username}}
        
        <div  class="interaction">
          <form method="POST" action="/like">
            <input type="hidden" name="post_id" value="{{.IdPost}}">
            <input type="hidden" name="value" value="1">
            <button class="like-btn">üëç Like</button>
          </form>

          <form method="POST" action="/like">
            <input type="hidden" name="post_id" value="{{.IdPost}}">
            <input type="hidden" name="value" value="-1">
            <button class="dislike-btn">üëé Dislike</button>
          </form>
      {{end}}
          <span class="counts">
            ‚ù§Ô∏è {{.Likes}} | üí¢ {{.Dislikes}}
          </span>
        </div>
        
        <!-- Comments -->
         {{if .Username}}
        <div class="comment-section">
          <form method="POST" action="/comment#post{{.IdPost}}">
            <input type="hidden" name="post_id" value="{{.IdPost}}">
            <input type="text" name="comment" placeholder="Write a comment..." required>
            <button type="submit" class="btn btn-small">Comment</button>
          </form>
          {{end}}
          <div class="comments-list">
            {{range .Comments}}
            <div class="comment">
              <span class="comment-user">{{.Username}}:</span>
              <span class="comment-content">{{.Content}}</span>
              <span class="comment-date">{{.CreatedAt}}</span>
            </div>
            {{end}}
          </div>
        </div>
      </article>
      {{else}}
        <div class="no-posts">
          <h2>No posts found.</h2>
        </div>
      {{end}}
    </section>
  </main>
</body>
